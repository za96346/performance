{"ast":null,"code":"import _asyncToGenerator from\"/Users/admin/Downloads/code/dajia/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/admin/Downloads/code/dajia/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/admin/Downloads/code/dajia/frontend/node_modules/@babel/runtime/regenerator/index.js\";import{useParams}from\"react-router-dom\";import{Return_component}from\"./data_input\";import{Loading}from\"./loading\";import{useState,useEffect,useRef}from\"react\";import{insert_performance_table}from\"../api\";import{select}from\"react-cookies\";import{check_and_recatch_data}from\"../method/method_func\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var New_performance=function New_performance(_ref){var data=_ref.data,synchronize_update=_ref.synchronize_update,synchronize=_ref.synchronize;var _useParams=useParams(),page=_useParams.page;var token=window.sessionStorage.getItem('token');var _useState=useState([]),_useState2=_slicedToArray(_useState,2),confirm_data=_useState2[0],set_confirm_data=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),page_data_arr=_useState4[0],set_page_data_arr=_useState4[1];var _useState5=useState('請選擇年份'),_useState6=_slicedToArray(_useState5,2),select_year=_useState6[0],set_select_year=_useState6[1];var year=['請選擇年份'];var Today=new Date();for(var i=-3;i<=3;i++){year.push(Today.getFullYear()-1911+i);}useEffect(function(){if(data.length!==0){set_page_data_arr(data);var arr=data.map(function(item){return[item[0],select_year,'yes'];//account,year,(yes or no)\n//yes =>this people need to insert to the table\n//no =>this people dont need to insert to the table\n});set_confirm_data(arr);}else{set_page_data_arr([]);set_confirm_data([]);}},[page,data,select_year]);function insert(){return _insert.apply(this,arguments);}function _insert(){_insert=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(select_year==='請選擇年份')){_context.next=3;break;}alert('請選擇年度');return _context.abrupt(\"return\");case 3:synchronize_update(true);_context.next=6;return insert_performance_table(token,confirm_data);case 6:result=_context.sent;if(result==='新增成功'){check_and_recatch_data(token,synchronize_update,2000);}alert(result);case 9:case\"end\":return _context.stop();}}},_callee);}));return _insert.apply(this,arguments);}if(!page_data_arr||synchronize===true){return/*#__PURE__*/_jsx(Loading,{});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"select\",{onChange:function onChange(e){return set_select_year(e.target.value);},children:year.map(function(item,index){return/*#__PURE__*/_jsx(\"option\",{value:index!==0?item:0,children:index!==0?\"\\u6C11\\u570B\".concat(item):item},index);})}),page_data_arr.length!==0?/*#__PURE__*/_jsx(Return_component,{page_data_arr:page_data_arr,set_page_data_arr:set_page_data_arr,synchronize_update:synchronize_update,number:5,page:page,confirm_data:confirm_data,set_confirm_data:set_confirm_data}):/*#__PURE__*/_jsx(_Fragment,{}),/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',alignItems:'center',justifyContent:'center',zIndex:100000},children:/*#__PURE__*/_jsx(\"button\",{name:\"create\",onClick:insert,children:\"\\u78BA\\u8A8D\\u65B0\\u589E\"})})]});};export default New_performance;","map":{"version":3,"sources":["/Users/admin/Downloads/code/dajia/frontend/src/page/backend_component/new_performance.js"],"names":["useParams","Return_component","Loading","useState","useEffect","useRef","insert_performance_table","select","check_and_recatch_data","New_performance","data","synchronize_update","synchronize","page","token","window","sessionStorage","getItem","confirm_data","set_confirm_data","page_data_arr","set_page_data_arr","select_year","set_select_year","year","Today","Date","i","push","getFullYear","length","arr","map","item","insert","alert","result","e","target","value","index","display","alignItems","justifyContent","zIndex"],"mappings":"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","sourcesContent":["import { useParams } from \"react-router-dom\"\nimport { Return_component } from \"./data_input\"\nimport { Loading } from \"./loading\"\nimport { useState,useEffect, useRef } from \"react\"\nimport { insert_performance_table } from \"../api\"\nimport { select } from \"react-cookies\"\nimport { check_and_recatch_data } from \"../method/method_func\"\nconst New_performance=({data,synchronize_update,synchronize})=>{\n    const {page}=useParams()\n    var token=window.sessionStorage.getItem('token')\n    const [confirm_data,set_confirm_data]=useState([])\n    const [page_data_arr,set_page_data_arr]=useState([])\n    const [select_year,set_select_year]=useState('請選擇年份')\n\n    const year=['請選擇年份']\n    var Today=new Date();\n    for(let i=-3;i<=3;i++){\n        year.push(Today.getFullYear()-1911+i)\n    }\n    useEffect(()=>{\n        if(data.length!==0){\n            set_page_data_arr(data)\n            var arr=data.map((item)=>{\n                return([item[0],select_year,'yes'])//account,year,(yes or no)\n                //yes =>this people need to insert to the table\n                //no =>this people dont need to insert to the table\n            })\n            set_confirm_data(arr)\n        }\n        else{\n            set_page_data_arr([])\n            set_confirm_data([])\n        }\n    },[page,data,select_year])\n\n    async function insert(){\n        //send api to insert performance table\n        //api(token,confirm_data)\n        \n        if(select_year==='請選擇年份'){\n            alert('請選擇年度')\n            return\n        }\n        synchronize_update(true)\n        var result=await insert_performance_table(token,confirm_data)\n        if(result==='新增成功'){\n            check_and_recatch_data(token,synchronize_update,2000)\n        }\n        alert(result)\n    }\n\n    if(!page_data_arr||synchronize===true){\n        return(<Loading/>)\n    }\n    return(\n<>\n                <select onChange={(e)=>set_select_year(e.target.value)}>\n                    {\n                        year.map((item,index)=>{\n                            return(<option value={index!==0?item:0} key={index}>{index!==0?`民國${item}`:item}</option>)\n                        })\n                    }\n                </select>\n            {\n                page_data_arr.length!==0\n                ?<Return_component \n                    page_data_arr={page_data_arr}\n                    set_page_data_arr={set_page_data_arr}\n                    synchronize_update={synchronize_update}\n                    number={5}\n                    page={page}\n                    confirm_data={confirm_data}\n                    set_confirm_data={set_confirm_data}/>\n                :<></>\n            }\n            <div style={{display:'flex',alignItems:'center',justifyContent:'center',zIndex:100000}}>\n                <button name=\"create\" \n                    onClick={insert}>確認新增</button>\n            </div>\n</>\n    )\n}\nexport default New_performance;"]},"metadata":{},"sourceType":"module"}